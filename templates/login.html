<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Login</title>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
      import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

      // TODO: paste your Firebase web config here
      const firebaseConfig = {
        apiKey: "AIzaSyCsPscAEUG-qyjIs8J_x3NQ6050KPwM-qA",
        authDomain: "sdassignment-ddfd7.firebaseapp.com",
        projectId: "sdassignment-ddfd7",
        appId: "1:300372904172:web:25b5c95a53951a4ec47dc9"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const provider = new GoogleAuthProvider();

      async function login() {
        const result = await signInWithPopup(auth, provider);
        const idToken = await result.user.getIdToken();

        const res = await fetch("/sessionLogin", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ idToken })
        });

        const json = await res.json();
        if (json.success) window.location.href = "/";
        else alert("Login failed: " + json.error);
      }

      window.login = login;
    </script>
  </head>
  <body>
    <h2>Login</h2>
    <button onclick="login()">Sign in with Google</button>
  </body>
</html>
